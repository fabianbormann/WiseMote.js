{% extends 'layout.html' %}

{% block head %}
<link rel="stylesheet" href="/css/codemirror.css">
{% parent %}
<script src="/js/codemirror.js"></script>
<script src="/js/mode/css.js"></script>
<script src="/js/mode/xml.js"></script>
<script src="/js/mode/javascript.js"></script>
<script src="/js/mode/htmlmixed.js"></script>
<script type="text/javascript">
	var l = window.location;
	var wisebedWebSocketBaseUrl = 'ws://' + l.host;
	var wisebedBaseUrl = l.protocol + '//' + l.host;

	$( document ).ready(function() {
		var delay;
		var editor = CodeMirror.fromTextArea(document.getElementById("code"), {
			mode: 'text/html',
			tabMode: 'indent'
		});
		editor.on("change", function() {
			clearTimeout(delay);
			delay = setTimeout(updatePreview, 300);
		});

		function updatePreview() {
			var previewFrame = document.getElementById("preview");
			var preview = previewFrame.contentDocument || previewFrame.contentWindow.document;
			preview.open();
			preview.write(editor.getValue());
			preview.close();
		}

        $('.ui.modal').modal();

        $('.ui.checkbox').checkbox();

        $('#virtualNodeOption').change(function() {
		   if($(this).is(":checked")) {
		      $('#useVirtualNode > label').text("No");
		      return;
		   }
		   $('#useVirtualNode > label').text("Yes");
		});

        $('#nodeConfig').click(function() {
            $('.virtualNode.modal')
            .modal('setting', 'closable', false)
            .modal('show');
        });

		setTimeout(updatePreview, 300);
	});
</script>
{% endblock %}

{% block content %}
<div class="ui virtualNode modal">
    <i class="circular inverted red close icon"></i>
    <div class="header">
        Project configuration
    </div>
    <div class="content">
    	<table id="projectOptions">
	    <tr>
	    <td><label>Use virtual node in Experiment</label></td>
	    <td><div id="useVirtualNode" class="ui toggle checkbox">
	  		<input type="checkbox" name="virtualNodeOption" id="virtualNodeOption">
	  		<label for="virtualNodeOption">No</label>
		</div></td>
		</tr>
		</table>
		<h2>Members</h2>
		{{ project.members }}
    </div>
    <div class="actions">
        <div class="ui button">Cancel</div>
        <div class="ui button">OK</div>
    </div>
</div>
<div class="sixteen wide column">
	<h1><i class="big code icon"></i>{{ project.name }}</h1>
	<button id="nodeConfig" class="ui red button">
		<i class="wrench icon"></i>
  		Configuration
	</button>
	<div class="ui divider"></div>
</div>
<div class="eight wide column">
	<form method="POST" action="/project/{{ project._id.toString() }}/save">
		<label>Project code:</label>
		<div class="field">
			<textarea id="code" name="code">{{ project.code }}</textarea>
		</div>    
	</div>
	<div class="eight wide column">
		<label>Preview:</label><br>
		<div class="field">
			<iframe id="preview"></iframe>
		</div>  
	</div>
	<div class="sixteen wide column">
		<div class="ui divider"></div>
		<div class="ui buttons">
			<button type="submit" class="ui blue button">Save</button>
		</form>
		<div class="or"></div>
		<button class="ui green button">Start experiment</button>
	</div>
</div>
{% endblock %}